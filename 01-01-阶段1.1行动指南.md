# 阶段 1.1 行动指南：初始化工程与打包配置 (Vite Library Mode)

这是为你准备的详细行动指南，请按照以下步骤一步步操作。每做完一步，你可以核对一下结果是否符合预期。

## 步骤 1：创建目录并初始化

1. 打开你的终端（Terminal 或 PowerShell），确保当前路径在项目根目录 `TrackPoint` 下。
2. 依次执行以下命令，创建 `packages/sdk` 文件夹并进入该文件夹：

```bash
mkdir -p packages/sdk
cd packages/sdk
```
*(如果是 Windows PowerShell 不支持 `mkdir -p`，可以先 `mkdir packages`，再 `cd packages`，再 `mkdir sdk`，最后 `cd sdk`)*

3. 初始化一个默认的 `package.json` 文件：

```bash
npm init -y
```

## 步骤 2：安装必要的依赖

在 `packages/sdk` 目录下，安装 Vite、TypeScript 以及用于生成类型声明文件的插件 `vite-plugin-dts`：

```bash
npm install vite typescript vite-plugin-dts -D
```

## 步骤 3：配置 TypeScript (`tsconfig.json`)

在 `packages/sdk` 目录下，新建文件 `tsconfig.json`，并将以下内容复制进去。这能确保我们在写 TS 代码时获得良好的类型检查，同时也为生成声明文件做准备：

```json
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ESNext", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    
    /* Declaration */
    "declaration": true,
    "outDir": "./dist"
  },
  "include": ["src/**/*.ts"],
  "exclude": ["node_modules", "dist"]
}
```

## 步骤 4：配置 Vite 库模式 (`vite.config.ts`)

在 `packages/sdk` 目录下，新建文件 `vite.config.ts`，并将以下内容复制进去。这里配置了 Vite 以库（Library）模式进行打包，并输出 ES Module 和 UMD 两种格式的代码。

```typescript
import { defineConfig } from 'vite';
import dts from 'vite-plugin-dts';
import path from 'path';

export default defineConfig({
  build: {
    lib: {
      // 指定入口文件
      entry: path.resolve(__dirname, 'src/index.ts'),
      // 暴露的全局变量名（UMD模式下，在浏览器中通过 window.TrackPoint 访问）
      name: 'TrackPoint',
      // 输出的文件名
      fileName: (format) => `track-point.${format}.js`,
    },
    // 如果有不需要打包进代码的外部依赖，可以在这里配置 rollupOptions.external
  },
  plugins: [
    // 自动生成 .d.ts 类型声明文件
    dts({
      insertTypesEntry: true,
    }),
  ],
});
```

## 步骤 5：创建源码入口文件

1. 在 `packages/sdk` 目录下创建 `src` 文件夹。
2. 在 `src` 文件夹中新建文件 `index.ts`，并写入一些简单的测试代码：

```bash
mkdir src
```

`src/index.ts` 内容：

```typescript
export const hello = () => {
  console.log('Hello, TrackPoint SDK!');
};

export const VERSION = '1.0.0';
```

## 步骤 6：配置打包脚本并修改入口信息

打开 `packages/sdk/package.json`，修改和添加以下字段，特别是 `name`、`scripts`、`main`、`module` 和 `types` 字段：

```json
{
  "name": "@byte/track-point",
  "version": "1.0.0",
  "description": "前端埋点 SDK",
  "main": "./dist/track-point.umd.js",
  "module": "./dist/track-point.es.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/track-point.es.js",
      "require": "./dist/track-point.umd.js"
    }
  },
  "scripts": {
    "dev": "vite build --watch",
    "build": "tsc && vite build"
  },
  "keywords": ["track", "sdk", "analytics"],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "typescript": "^5.0.0",
    "vite": "^5.0.0",
    "vite-plugin-dts": "^3.0.0"
  }
}
```
*(注意：上面的 `devDependencies` 中的版本号可能与你实际安装的略有不同，保留你实际安装生成的版本号即可，只需重点把其余增加和修改的字段合并进去即可。)*

## 步骤 7：执行打包，验收结果！

在终端中（确保当前在 `packages/sdk` 目录下），运行打包命令：

```bash
npm run build
```

**验收标准**：
如果你看到终端提示打包成功，并且你的 `packages/sdk` 目录下多了一个 `dist` 文件夹，里面包含以下核心文件：
- `track-point.es.js` (ES Module 格式代码)
- `track-point.umd.js` (UMD 格式代码)
- `index.d.ts` (TypeScript 类型声明文件)

那么恭喜你！阶段 1.1 圆满完成。我们已经拥有了一个现代化的 SDK 打包骨架。

**请你按照以上步骤一步步操作，如果你在执行过程中遇到任何报错（比如依赖安装报错、执行 build 报错），直接把报错信息发给我；如果一切顺利拿到了 `dist` 目录，也请告诉我，我们就立刻进入下一阶段（1.2 核心类结构）！**